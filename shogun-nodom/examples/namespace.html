<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shogun Nodom - Automatic Namespace</title>
</head>
<body>
  <h1>Shogun Nodom with Automatic Namespace</h1>
  
  <div class="auth-container">
    <h2>Authentication</h2>
    <div>
      <input id="username" type="text" placeholder="Username" />
      <input id="password" type="password" placeholder="Password" />
      <button id="loginBtn">Login</button>
      <button id="signupBtn">Register</button>
      <button id="logoutBtn">Logout</button>
    </div>
    <div class="message" id="authMessage"></div>
  </div>
  
  <div>
    <h2>Current Namespace:</h2>
    <div class="namespace-display" id="namespaceDisplay">Not authenticated</div>
  </div>
  
  <div class="container">
    <h2>Public Form (global)</h2>
    <p>This form saves data in a public space accessible to everyone</p>
    <div id="publicFormContainer"></div>
  </div>
  
  <div class="container">
    <h2>Form with Automatic Namespace</h2>
    <p>This form uses the automatic namespace for all fields within it</p>
    <div id="privateFormContainer"></div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>
  <script type="module">
    import { init, setSignal, setEffect, auth, getNamespace, logout, setNamespace, h, jsx } from '../nodom.js';
    
    // Initialize Gun with a local peer
    const gun = Gun(['http://localhost:8765/gun']);
    init(gun);
    
    // DOM Elements
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('loginBtn');
    const signupBtn = document.getElementById('signupBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const authMessage = document.getElementById('authMessage');
    const namespaceDisplay = document.getElementById('namespaceDisplay');
    const publicFormContainer = document.getElementById('publicFormContainer');
    const privateFormContainer = document.getElementById('privateFormContainer');
    
    // Function to update the namespace display
    function updateNamespaceDisplay() {
      const namespace = getNamespace();
      namespaceDisplay.textContent = namespace || 'Not authenticated';
      
      // Update forms when the namespace changes
      renderPublicForm();
      renderPrivateForm();
    }
    
    // Function to create the public form (without namespace)
    function renderPublicForm() {
      // Empty the container
      publicFormContainer.innerHTML = '';
      
      // Create a simple form
      const form = h('div', {},
        h('input', { name: 'public-name', placeholder: 'Your public name' }),
        h('br', {}),
        h('input', { name: 'public-message', placeholder: 'Public message' }),
        h('br', {}),
        h('div', {}, 'Public data:'),
        h('div', {}, () => {
          const [getName] = setSignal('', { key: 'public-name' });
          const [getMessage] = setSignal('', { key: 'public-message' });
          return `Name: ${getName()}, Message: ${getMessage()}`;
        })
      );
      
      publicFormContainer.appendChild(form);
    }
    
    // Function to create the private form with automatic namespace
    function renderPrivateForm() {
      // Empty the container
      privateFormContainer.innerHTML = '';
      
      const namespace = getNamespace();
      
      if (!namespace) {
        privateFormContainer.textContent = 'Login to access the private form';
        return;
      }
      
      // Create the form with two different approaches: JSX with namespace and DOM Elements

      // APPROACH 1: JSX with namespace property 
      // (this might not work if there are issues with the context system)
      const privateForm = h('div', { namespace },
        h('div', { class: 'user-section' },
          h('h3', {}, 'Your private data (JSX)'),
          h('p', {}, `All fields here automatically use the namespace: ${namespace}`),
          h('input', { name: 'name-jsx', placeholder: 'Name (JSX)' }),
          h('br', {}),
          h('input', { name: 'bio-jsx', placeholder: 'Bio (JSX)' }),
          h('br', {}),
          h('div', {}, 'Saved data:'),
          h('div', { id: 'jxsDataDisplay' }, '')
        )
      );
      
      // Add the form to the container
      privateFormContainer.appendChild(privateForm);
      
      // Display data for both approaches
      const jxsDataDisplay = document.getElementById('jxsDataDisplay');
      
      // Effect for JSX data
      setEffect(() => {
        const [getNameJsx] = setSignal('', { key: 'name-jsx', element: document.querySelector('input[name="name-jsx"]') });
        const [getBioJsx] = setSignal('', { key: 'bio-jsx', element: document.querySelector('input[name="bio-jsx"]') });
        
        if (jxsDataDisplay) {
          jxsDataDisplay.textContent = `Name: ${getNameJsx() || '(not set)'}, Bio: ${getBioJsx() || '(not set)'}`;
        }
      });
    }
    
    // Event listeners for authentication buttons
    loginBtn.addEventListener('click', async () => {
      const username = usernameInput.value;
      const password = passwordInput.value;
      
      if (!username || !password) {
        authMessage.textContent = 'Username and password required';
        return;
      }
      
      try {
        authMessage.textContent = 'Login in progress...';
        const result = await auth(username, password, false);
        authMessage.textContent = 'Login completed successfully!';
        updateNamespaceDisplay();
      } catch (err) {
        authMessage.textContent = `Login error: ${err}`;
      }
    });
    
    signupBtn.addEventListener('click', async () => {
      const username = usernameInput.value;
      const password = passwordInput.value;
      
      if (!username || !password) {
        authMessage.textContent = 'Username and password required';
        return;
      }
      
      try {
        authMessage.textContent = 'Registration in progress...';
        const result = await auth(username, password, true);
        authMessage.textContent = 'Registration and login completed successfully!';
        updateNamespaceDisplay();
      } catch (err) {
        authMessage.textContent = `Registration error: ${err}`;
      }
    });
    
    logoutBtn.addEventListener('click', () => {
      logout();
      authMessage.textContent = 'Logout completed';
      updateNamespaceDisplay();
    });
    
    // Initialization
    updateNamespaceDisplay();
  </script>
</body>
</html> 