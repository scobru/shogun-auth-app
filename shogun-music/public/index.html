<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shogun Music - Home</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav class="navbar">
    <div class="navbar-container">
      <a href="index.html" class="navbar-brand">Shogun Music</a>
      <div class="navbar-links">
        <a href="index.html">Home</a>
        <a href="dashboard.html">Dashboard</a>
      </div>
    </div>
  </nav>

  <header>
    <h1>Shogun Music</h1>
    <p>Scopri e ascolta musica indipendente</p>
  </header>
  
  <div class="content">
    <div id="releaseGrid" class="release-grid"></div>
    <div id="noReleases" style="text-align: center; display: none;">
      <p>Nessuna release trovata. Vai alla <a href="dashboard.html">Dashboard</a> per aggiungere contenuti.</p>
    </div>
    <div class="spinner" id="loadingSpinner"></div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
  <script>
    const gun = Gun({
      peers: ['http://localhost:3000/gun'],
      localStorage: false
    });
    
    const releaseGrid = document.getElementById('releaseGrid');
    const noReleases = document.getElementById('noReleases');
    const loadingSpinner = document.getElementById('loadingSpinner');
    
    // Mostra lo spinner durante il caricamento
    loadingSpinner.style.display = 'block';
    
    // Teniamo traccia se abbiamo trovato almeno una release
    let foundReleases = false;
    
    // Timeout per mostrare il messaggio se non ci sono release
    setTimeout(() => {
      if (!foundReleases) {
        loadingSpinner.style.display = 'none';
        noReleases.style.display = 'block';
      }
    }, 3000);
    
    // Ascoltiamo il nodo "releases" per recuperare la lista di release
    gun.get('releases').map().on((release, id) => {
      loadingSpinner.style.display = 'none';
      
      if (!release) {
        // Se release viene eliminata o non esiste, rimuoviamo l'elemento dalla griglia
        const existingCard = document.getElementById(id);
        if (existingCard) existingCard.remove();
        return;
      }
      
      foundReleases = true;
      noReleases.style.display = 'none';
      
      // Verifichiamo se esiste gi√† una card per questa release
      let card = document.getElementById(id);
      if (!card) {
        card = document.createElement('div');
        card.className = 'release-card';
        card.id = id;
        releaseGrid.appendChild(card);
      }
      
      // Aggiorniamo il contenuto della card
      card.innerHTML = `
        <div class="release-artwork">
          <img src="${release.artwork || 'https://via.placeholder.com/200x200?text=No+Image'}" alt="Artwork" />
        </div>
        <h3>${release.title || 'Untitled'}</h3>
        <p>${release.date || ''}</p>
        <p>${release.type === 'single' ? 'Single' : 'EP'}</p>
        <a href="release.html?id=${id}">Ascolta</a>
      `;
    });
  </script>
</body>
</html>
