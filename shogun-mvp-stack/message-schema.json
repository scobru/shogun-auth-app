{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ZKitter Message",
  "type": "object",
  "properties": {
    "id": { "type": "string", "maxLength": 255 },
    "type": { "type": "string", "maxLength": 15, "enum": ["POST", "PROFILE", "FILE", "MODERATION", "CONNECTION", "@TWEET@"] },
    "subtype": { "type": "string", "maxLength": 15 },
    "creator": { "type": "string", "maxLength": 65535 },
    "createdAt": { "type": "integer", "minimum": 0 },
    "payload": { "type": "object" }
  },
  "required": ["id", "type", "subtype", "creator", "createdAt", "payload"],
  "additionalProperties": false,
  "allOf": [
    {
      "if": { "properties": { "type": { "const": "PROFILE" } } },
      "then": {
        "properties": {
          "subtype": { "enum": ["NICKNAME", "BIO", "PROFILE_IMAGE", "CUSTOM"], "type": "string" },
          "payload": {
            "type": "object",
            "oneOf": [
              {
                "properties": { "value": { "type": "string", "maxLength": 255 } },
                "required": ["value"],
                "additionalProperties": false
              },
              {
                "properties": {
                  "key": { "type": "string", "maxLength": 255 },
                  "value": { "type": "string", "maxLength": 16777215 }
                },
                "required": ["key", "value"],
                "additionalProperties": false
              }
            ]
          }
        }
      }
    },
    {
      "if": { "properties": { "type": { "const": "POST" } } },
      "then": {
        "properties": {
          "subtype": { "enum": ["", "REPLY", "REPOST", "M_POST", "M_REPLY"], "type": "string" },
          "payload": {
            "type": "object",
            "properties": {
              "topic": { "type": "string", "maxLength": 255 },
              "title": { "type": "string", "maxLength": 255 },
              "content": { "type": "string", "maxLength": 16777215 },
              "reference": { "type": "string", "maxLength": 255 },
              "attachment": { "type": "string", "maxLength": 255 }
            },
            "required": ["topic", "title", "content", "reference", "attachment"],
            "additionalProperties": false
          }
        }
      }
    },
    {
      "if": { "properties": { "type": { "const": "FILE" } } },
      "then": {
        "properties": {
          "subtype": { "enum": ["TORRENT", "IPFS"], "type": "string" },
          "payload": {
            "type": "object",
            "properties": {
              "name": { "type": "string", "maxLength": 255 },
              "mimeType": { "type": "string", "maxLength": 255 },
              "data": { "type": "string", "maxLength": 16777215 }
            },
            "required": ["name", "mimeType", "data"],
            "additionalProperties": false
          }
        }
      }
    },
    {
      "if": { "properties": { "type": { "const": "MODERATION" } } },
      "then": {
        "properties": {
          "subtype": { "enum": ["LIKE", "BLOCK"], "type": "string" },
          "payload": {
            "type": "object",
            "properties": { "reference": { "type": "string", "maxLength": 255 } },
            "required": ["reference"],
            "additionalProperties": false
          }
        }
      }
    },
    {
      "if": { "properties": { "type": { "const": "CONNECTION" } } },
      "then": {
        "properties": {
          "subtype": { "enum": ["FOLLOW", "BLOCK", "MEMBER_INVITE", "MEMBER_ACCEPT"], "type": "string" },
          "payload": {
            "type": "object",
            "properties": { "name": { "type": "string", "maxLength": 65535 } },
            "required": ["name"],
            "additionalProperties": false
          }
        }
      }
    }
  ]
}
